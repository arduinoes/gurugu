import{d as p,o as i,c as n,b as l,t as c,m as w,F as y,i as _,l as V,s as d,n as $,u as o,p as h,f,e as m,q as D}from"./index.6444fcef.js";const P={class:"row g-3 align-items-center my-2"},x={class:"col-auto my-2"},E={class:"col-form-label",style:{}},A={class:"col-auto"},z=["placeholder","value"],g=p({__name:"BaseInput",props:{label:{type:String,default:""},modelValue:{type:[String,Number],default:""}},setup(t){return(e,r)=>(i(),n("div",P,[l("div",x,[l("label",E,c(t.label),1)]),l("div",A,[l("input",{type:"text",class:"form-control",placeholder:t.label,value:t.modelValue,onInput:r[0]||(r[0]=a=>e.$emit("update:modelValue",a.target.value))},null,40,z)])]))}}),U={class:"container"},k={class:"mb-3"},S={class:"form-label"},F=["placeholder","value"],I=p({__name:"BaseInputDate",props:{label:{type:String,default:""},modelValue:{type:[Date,String,Number],default:""}},setup(t){return(e,r)=>(i(),n("div",U,[l("div",k,[l("label",S,c(t.label),1),l("input",{type:"date",class:"form-control",placeholder:t.label,value:t.modelValue,onInput:r[0]||(r[0]=a=>e.$emit("update:modelValue",a.target.value))},null,40,F)])]))}}),C={class:"container"},N={class:"mb-3"},B={class:"form-label"},T=["placeholder","value"],b=p({__name:"BaseInputTime",props:{label:{type:String,default:""},modelValue:{type:[Date,String,Number],default:""}},setup(t){return(e,r)=>(i(),n("div",C,[l("div",N,[l("label",B,c(t.label),1),l("input",{type:"time",class:"form-control",placeholder:t.label,value:t.modelValue,onInput:r[0]||(r[0]=a=>e.$emit("update:modelValue",a.target.value))},null,40,T)])]))}}),q={class:"container"},L={class:"mb-3"},R={class:"form-label"},M=["value"],G=["value","selected"],Y=p({__name:"BaseSeleccion",props:{options:{type:Array,required:!0},label:{type:String,default:""},modelValue:{type:[String,Number],default:""}},setup(t){return(e,r)=>(i(),n("div",q,[l("div",L,[l("label",R,c(t.label),1),l("select",w({class:"form-select",value:t.modelValue},{...e.$attrs,onChange:a=>{e.$emit("update:modelValue",a.target.value)}}),[(i(!0),n(y,null,_(t.options,a=>(i(),n("option",{value:a,key:a,selected:a===t.modelValue},c(a),9,G))),128))],16,M)])]))}}),j=V({id:"form",state:()=>({options:["Para todos los p\xFAblicos","Para beb\xE9s","Para ni\xF1os","Para adolescentes","Para adultos"],productos:[],size:"16em",uploading:!1,loading:!1,src:"",files:null,filePath:null,error:null,editar:!1,urlDescarga:{},producto:{id:"",title:"",company:"",description:"",image:"",data:0,showtime:0,recommended:""}}),actions:{async obtenerDatos(){try{const{data:t,error:e}=await d.from("elementos").select("*").order("id");if(e){console.log("error",e);return}if(t===null){this.productos=[];return}this.productos=t,console.log("Productos ",this.productos)}catch(t){console.error("Error retrieving data from db",t)}},async obtenerDatoId(t){try{const{data:e,error:r}=await d.from("elementos").select("id, title, description, price").eq("id",t).single();if(r){console.log("error",r);return}e===null&&(this.productos=[]),this.producto=e,console.log("Producto ",this.producto)}catch(e){console.error("Error retrieving data from db",e)}},async eliminarDato(t){try{await d.from("elementos").delete().eq("id",t),console.log("Dato eliminado",t)}catch(e){console.error("error",e)}},async agregarDato(){this.loading=!0;try{const t={title:this.producto.title,company:this.producto.company,description:this.producto.description,data:this.producto.data,showtime:this.producto.showtime,recommended:this.producto.recommended,image:this.urlDescarga},{data:e,error:r}=await d.from("elementos").insert(t).single();return r?(alert(r),console.error("There was an error inserting",r.message),null):(console.log("Nuevo producto creado"),e)}catch(t){return alert("Error"),console.error("Unknown problem inserting to db",t),null}finally{this.loading=!1}},async actualizarDatoCampo(t,e){try{const{error:r}=await d.from("elementos").update({is_complete:e}).eq("id",t.id).single();if(r){alert(r.message),console.error("There was an error updating",r);return}console.log("Dato validado",t.id)}catch(r){alert("Error"),console.error("Unknown problem updating record",r)}},async actualizarDato(){this.loading=!0;try{const t={id:this.producto.id,title:this.producto.title,company:this.producto.company,description:this.producto.description,data:this.producto.data,showtime:this.producto.showtime,recommended:this.producto.recommended,image:this.urlDescarga},{error:e}=await d.from("elementos").upsert(t,{returning:"minimal"});if(e)throw e}catch(t){alert(t)}finally{this.loading=!0}},async subirArchivoAgregar(t){var e;this.files=t.target.files;try{if(this.uploading=!0,!this.files||this.files.length===0)throw new Error("You must select an image to upload.");const r=this.files[0],a=r.name.split(".").pop(),s=`${Math.random()}.${a}`;this.filePath=`${s}`,console.log("filePath ",this.filePath);const{error:u}=await d.storage.from("avatars").upload(this.filePath,r);if(u)throw u;this.urlDescarga=await((e=d.storage.from("avatars").getPublicUrl(s).data)==null?void 0:e.publicURL),console.log("urlDescarga",this.urlDescarga),this.downloadImage(),this.agregarDato()}catch(r){alert(r)}finally{this.uploading=!1}},async subirArchivoActualizar(t){var e;this.files=t.target.files;try{if(this.uploading=!0,!this.files||this.files.length===0)throw new Error("You must select an image to upload.");const r=this.files[0],a=r.name.split(".").pop(),s=`${Math.random()}.${a}`;this.filePath=`${s}`,console.log("filePath ",this.filePath);const{error:u}=await d.storage.from("avatars").upload(this.filePath,r);if(u)throw u;this.urlDescarga=await((e=d.storage.from("avatars").getPublicUrl(s).data)==null?void 0:e.publicURL),console.log("urlDescarga",this.urlDescarga),this.downloadImage(),this.actualizarDato()}catch(r){alert(r)}finally{this.uploading=!1}},async downloadImage(){try{const{data:t,error:e}=await d.storage.from("avatars").download(this.filePath);if(console.log("donwnload",this.filePath),e)throw e;this.src=URL.createObjectURL(t),console.log("src ",this.src)}catch(t){console.error("Error downloading image: ",t)}}}});const O={class:"container"},H={class:""},J=["src"],K={key:0,class:"btn btn-primary",for:"single"},Q=["disabled"],W={key:1,class:"btn btn-primary",for:"single"},X=["disabled"],Z={class:"table"},ee=l("thead",null,[l("tr",null,[l("th",{scope:"col"},"id"),l("th",{scope:"col"},"Title"),l("th",{scope:"col"},"Price"),l("th",{scope:"col"},"Editar"),l("th",{scope:"col"},"Eliminar")])],-1),te={scope:"row"},oe=["onClick"],ae=["onClick"],re=p({__name:"Formulario",setup(t){const e=j();return $(()=>{e.obtenerDatos()}),(r,a)=>(i(),n("div",O,[l("form",null,[l("div",H,[o(e).src?(i(),n("img",{key:0,src:o(e).src,class:"imagen",style:h({height:o(e).size,width:o(e).size})},null,12,J)):(i(),n("div",{key:1,class:"imagen",style:h({height:o(e).size,width:o(e).size})},null,4)),l("div",{style:h({width:o(e).size})},[o(e).editar===!1?(i(),n("label",K,[f(c(o(e).uploading?"Guardando ...":"Guardar")+" ",1),l("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",onChange:a[0]||(a[0]=(...s)=>o(e).subirArchivoAgregar&&o(e).subirArchivoAgregar(...s)),disabled:o(e).uploading},null,40,Q)])):(i(),n("label",W,[f(c(o(e).uploading?"Actualizando ...":"Actualizar")+" ",1),l("input",{style:{visibility:"hidden",position:"absolute"},type:"file",id:"single",accept:"image/*",onChange:a[1]||(a[1]=(...s)=>o(e).subirArchivoActualizar&&o(e).subirArchivoActualizar(...s)),disabled:o(e).uploading},null,40,X)]))],4)]),m(g,{modelValue:o(e).producto.title,"onUpdate:modelValue":a[2]||(a[2]=s=>o(e).producto.title=s),type:"text",label:"T\xEDtulo de la obra"},null,8,["modelValue"]),m(g,{modelValue:o(e).producto.company,"onUpdate:modelValue":a[3]||(a[3]=s=>o(e).producto.company=s),type:"text",label:"Compa\xF1ia"},null,8,["modelValue"]),m(I,{modelValue:o(e).producto.data,"onUpdate:modelValue":a[4]||(a[4]=s=>o(e).producto.data=s),type:"text",label:"Fecha"},null,8,["modelValue"]),m(b,{modelValue:o(e).producto.showtime,"onUpdate:modelValue":a[5]||(a[5]=s=>o(e).producto.showtime=s),type:"text",label:"Primera funci\xF3n"},null,8,["modelValue"]),m(b,{modelValue:o(e).producto.showtime,"onUpdate:modelValue":a[6]||(a[6]=s=>o(e).producto.showtime=s),type:"text",label:"Segunda funci\xF3n"},null,8,["modelValue"]),m(Y,{options:o(e).options,modelValue:o(e).producto.recommended,"onUpdate:modelValue":a[7]||(a[7]=s=>o(e).producto.recommended=s),label:"Recomendada para edades"},null,8,["options","modelValue"]),m(g,{modelValue:o(e).producto.description,"onUpdate:modelValue":a[8]||(a[8]=s=>o(e).producto.description=s),type:"text",label:"Descripci\xF3n"},null,8,["modelValue"])]),l("table",Z,[ee,l("tbody",null,[(i(!0),n(y,null,_(o(e).productos,(s,u)=>(i(),n("tr",{key:u},[l("th",te,c(u),1),l("td",null,c(s.title),1),l("td",null,c(s.company),1),l("td",null,[l("button",{onClick:D(v=>{o(e).obtenerDatoId(s.id),o(e).editar=!o(e).editar},["prevent"]),class:"btn btn-primary"}," Editar ",8,oe)]),l("td",null,[l("button",{onClick:v=>o(e).eliminarDato(s.id),class:"btn btn-danger"}," Eliminar ",8,ae)])]))),128))])])]))}});export{re as default};
